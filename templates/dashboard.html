{% extends "layout.html" %} <!-- Step 1: Extend the layout -->

<!-- Step 2: Change title -->
{% block title %}
    Farmer Dashboard
{% endblock %}

<!-- Step 3: Put all content inside this block -->
{% block content %}
<main>
    
    <!-- Welcome Message -->
    <!-- 'current_user' is automatically provided by Flask-Login -->
    <h2 style="text-align: left; border-bottom: none; margin-bottom: 30px;" class="animate-on-load">
        Hello, {{ current_user.username }}!
    </h2>

    <!-- Dashboard Grid Layout -->
    <div class="dashboard-grid">

        <!-- 1. Form to change city -->
        <section class="form-box animate-on-load">
            <h3>My Weather Setting</h3>
            <p style="margin-bottom: 20px;">Your currently saved city is: <br><strong>{{ current_user.city }}</strong></p>
            
            <form method="POST" action="/update_city">
                <div class="form-group">
                    <label for="city">Change Your City (In English):</label>
                    <input type="text" id="city" name="city" placeholder="e.g. Mumbai, Pune" required>
                </div>
                <button type="submit" class="btn">Save City</button>
            </form>
        </section>

        <!-- 2. User's Activity (Posts) -->
        <section class="info-card animate-on-load">
            <h3>My Activity</h3>
            <p>Your recent questions posted to the community will appear here.</p>
            
            <!-- 
            FUTURE FEATURE: We can loop through the user's posts
            {% for post in current_user.posts | reverse %}
                <div class="user-post-snippet">
                    <p>"{{ post.content | truncate(80) }}"</p>
                    <small>Posted on: {{ post.timestamp.strftime('%Y-%m-%d') }}</small>
                </div>
            {% else %}
                <p>You have not posted any questions yet.</p>
            {% endfor %}
            -->

            {% if not current_user.posts %}
                 <p>You have not posted any questions yet. <a href="{{ url_for('community') }}">Ask one!</a></p>
            {% endif %}

            <!-- This will show the 5 most recent posts -->
            {% for post in current_user.posts | reverse %}
                 <p style="background: #f9f9f9; padding: 10px; border-radius: 5px; border-left: 3px solid #28a745;">
                    <em>"{{ post.content | truncate(80) }}"</em>
                 </p>
            {% endfor %}

        </section>

    </div> <!-- .dashboard-grid ends -->

</main>
{% endblock %}